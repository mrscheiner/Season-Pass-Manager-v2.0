<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Season Pass Manager - Quick Access</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            font-size: 24px;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            font-size: 14px;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .button {
            display: inline-block;
            padding: 15px 30px;
            margin: 10px;
            background: #007AFF;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
        }
        .url-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
        }
        #qrcode {
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            display: inline-block;
        }
        .instructions {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
            font-size: 14px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <h1>üèí Season Pass Manager</h1>
    
    <div id="status" class="status loading">
        Checking server status...
    </div>

    <div id="qrcode"></div>
    
    <div id="urlDisplay" class="url-display" style="display: none;">
        <strong>Tunnel URL:</strong><br>
        <span id="tunnelUrl"></span>
    </div>

    <div id="buttons" style="display: none;">
        <a id="openButton" class="button">üì± Open in Expo Go</a>
    </div>

    <div class="instructions">
        <strong>üìå Add to Home Screen:</strong>
        <ol style="margin: 10px 0; padding-left: 20px;">
            <li>Tap the Share button in Safari</li>
            <li>Scroll down and tap "Add to Home Screen"</li>
            <li>Now you have a one-tap shortcut! üéâ</li>
        </ol>
    </div>

    <script>
        async function checkServer() {
            try {
                // Check if Expo is running
                const response = await fetch('http://localhost:8081/status', { 
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                // Try to get the tunnel URL from a status endpoint
                return await getTunnelUrl();
            } catch (error) {
                return null;
            }
        }

        async function getTunnelUrl() {
            try {
                // We'll have the start script write the URL to a JSON file
                const response = await fetch('/tunnel-status.json');
                const data = await response.json();
                return data.url;
            } catch (error) {
                console.error('Could not get tunnel URL:', error);
                return null;
            }
        }

        async function initialize() {
            const statusDiv = document.getElementById('status');
            const qrcodeDiv = document.getElementById('qrcode');
            const urlDisplay = document.getElementById('urlDisplay');
            const tunnelUrlSpan = document.getElementById('tunnelUrl');
            const buttonsDiv = document.getElementById('buttons');
            const openButton = document.getElementById('openButton');

            // Try to get tunnel URL
            const tunnelUrl = await getTunnelUrl();

            if (tunnelUrl) {
                statusDiv.className = 'status ready';
                statusDiv.textContent = '‚úÖ Server is running!';
                
                // Display URL
                tunnelUrlSpan.textContent = tunnelUrl;
                urlDisplay.style.display = 'block';
                
                // Generate QR code
                QRCode.toCanvas(tunnelUrl, { width: 250 }, function (error, canvas) {
                    if (!error) {
                        qrcodeDiv.appendChild(canvas);
                    }
                });
                
                // Set up button
                openButton.href = tunnelUrl;
                buttonsDiv.style.display = 'block';
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = '‚ùå Server not running<br><small>Run ./start-tunnel.sh first</small>';
                qrcodeDiv.style.display = 'none';
            }
        }

        // Auto-refresh every 5 seconds
        initialize();
        setInterval(initialize, 5000);
    </script>
</body>
</html>
